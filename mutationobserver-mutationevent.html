<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="utf-8" />
	<title>Getting to Know Mutation Observers: The problem with mutation events</title>
	<link rel="stylesheet" href="mutationobserver.css">
</head>
<body>
<header>
	<h1>The problem with mutation events</h1>
	<nav><a href="">Return to article</a></nav>
</header>

<article>
	<p>In this example, we are creating 2500 paragraphs, and appending them to a document fragment. Then we'll append that document fragment to a <code>div</code> element. 2500 mutation events will be fired as a result. That means our event handler for the <code>DOMNodeInserted</code> event will be invoked 2500 times.</p>
	<p><b class="numevents">0</b> mutation events have been fired.</p>
	<p><button>Run demo</button></p>
</article>

<div class="demo"></div>

<script>
(function(w,d){
	var thismany = 2500,
	eventcount = 0,
	btn = d.querySelector('button'),
	demo = d.querySelector('.demo'),
	clickhandler = function(){
		var i = 0, 
		docfrag = d.createDocumentFragment(), 
		n = thismany, p,
		sentence = 'Lorem ipsum dolar sit amet consecutum.';
		
		while( i < n ){
			p = (p !== undefined) ? p = p.cloneNode(false) : p = d.createElement('p');
			p.textContent = sentence;
			docfrag.appendChild(p);
			i++;
		}
		
		demo.appendChild(docfrag);
	}, 
	onnodeinsert = function(){
		eventcount++;
		var numevents = d.querySelector('.numevents');
		numevents.textContent = eventcount;	
	}
		
	demo.addEventListener('DOMNodeInserted',onnodeinsert,false);
	btn.addEventListener('click',clickhandler,false);
	
})(window, document)
</script>

</body>
</html>
